blueprint:
  name: "IKEA Bilresa – 3 Buttons"
  description: "3 independent buttons (1×/2×/3× click + hold-dimming per button) + cover support"
  domain: automation

  input:
    # ════════════════════════════════════════════════════════════
    # BUTTON 1
    # ════════════════════════════════════════════════════════════
    button1_event_entity:
      name: "Button 1 – Event Entity"
      description: "Event entity of Button 1"
      selector:
        entity:
          domain: event

    button1_single_press_light:
      name: "Button 1 – Single Press Light"
      selector:
        entity:
          domain: light
      default: ""

    button1_single_press_action:
      name: "Button 1 – Single Press Action"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    button1_double_press_light:
      name: "Button 1 – Double Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button1_double_press_type:
      name: "Button 1 – Double Press Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
      default: "light"

    button1_double_press_light_action:
      name: "Button 1 – Double Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    button1_double_press_scene:
      name: "Button 1 – Double Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button1_triple_press_light:
      name: "Button 1 – Triple Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button1_triple_press_type:
      name: "Button 1 – Triple Press Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
      default: "light"

    button1_triple_press_light_action:
      name: "Button 1 – Triple Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    button1_triple_press_scene:
      name: "Button 1 – Triple Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button1_hold_light:
      name: "Button 1 – Hold/Release Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button1_hold_direction:
      name: "Button 1 – Dimming Direction When Holding"
      selector:
        select:
          options:
            - label: "Brighten (increase)"
              value: "brighter"
            - label: "Darken (decrease)"
              value: "darker"
      default: "brighter"

    button1_hold_brightness_step:
      name: "Button 1 – Brightness Per Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BUTTON 2
    # ════════════════════════════════════════════════════════════
    button2_event_entity:
      name: "Button 2 – Event Entity (optional)"
      selector:
        entity:
          domain: event
      default: ""

    button2_single_press_light:
      name: "Button 2 – Single Press Light"
      selector:
        entity:
          domain: light
      default: ""

    button2_single_press_action:
      name: "Button 2 – Single Press Action"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    button2_double_press_light:
      name: "Button 2 – Double Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button2_double_press_type:
      name: "Button 2 – Double Press Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
      default: "light"

    button2_double_press_light_action:
      name: "Button 2 – Double Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    button2_double_press_scene:
      name: "Button 2 – Double Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button2_triple_press_light:
      name: "Button 2 – Triple Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button2_triple_press_type:
      name: "Button 2 – Triple Press Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
      default: "light"

    button2_triple_press_light_action:
      name: "Button 2 – Triple Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    button2_triple_press_scene:
      name: "Button 2 – Triple Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button2_hold_light:
      name: "Button 2 – Hold/Release Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button2_hold_direction:
      name: "Button 2 – Dimming Direction When Holding"
      selector:
        select:
          options:
            - label: "Brighten (increase)"
              value: "brighter"
            - label: "Darken (decrease)"
              value: "darker"
      default: "brighter"

    button2_hold_brightness_step:
      name: "Button 2 – Brightness Per Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BUTTON 3 (with Cover Support)
    # ════════════════════════════════════════════════════════════
    button3_event_entity:
      name: "Button 3 – Event Entity (optional)"
      selector:
        entity:
          domain: event
      default: ""

    button3_single_press_light:
      name: "Button 3 – Single Press Light"
      selector:
        entity:
          domain: light
      default: ""

    button3_single_press_type:
      name: "Button 3 – Single Press – Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
            - label: "Curtain / Cover (Open/Close)"
              value: "cover"
      default: "light"

    button3_single_press_action:
      name: "Button 3 – Single Press Action"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "toggle"

    button3_single_press_scene:
      name: "Button 3 – Single Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_single_press_cover:
      name: "Button 3 – Single Press – Cover/Curtain (optional)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_single_press_cover_action:
      name: "Button 3 – Single Press – Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_double_press_light:
      name: "Button 3 – Double Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button3_double_press_type:
      name: "Button 3 – Double Press – Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
            - label: "Curtain / Cover (Open/Close)"
              value: "cover"
      default: "light"

    button3_double_press_light_action:
      name: "Button 3 – Double Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_50"

    button3_double_press_scene:
      name: "Button 3 – Double Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_double_press_cover:
      name: "Button 3 – Double Press – Cover/Curtain (optional)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_double_press_cover_action:
      name: "Button 3 – Double Press – Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_triple_press_light:
      name: "Button 3 – Triple Press Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button3_triple_press_type:
      name: "Button 3 – Triple Press Action Type"
      selector:
        select:
          options:
            - label: "Light (Brightness/Toggle)"
              value: "light"
            - label: "Activate Scene"
              value: "scene"
            - label: "Curtain / Cover (Open/Close)"
              value: "cover"
      default: "light"

    button3_triple_press_light_action:
      name: "Button 3 – Triple Press Action (Light)"
      selector:
        select:
          options:
            - label: "Toggle (On/Off)"
              value: "toggle"
            - label: "Turn On"
              value: "turn_on"
            - label: "Turn Off"
              value: "turn_off"
            - label: "25% Brightness"
              value: "brightness_25"
            - label: "50% Brightness"
              value: "brightness_50"
            - label: "75% Brightness"
              value: "brightness_75"
            - label: "100% Brightness"
              value: "brightness_100"
      default: "brightness_100"

    button3_triple_press_scene:
      name: "Button 3 – Triple Press Scene (optional)"
      selector:
        entity:
          domain: scene
      default: ""

    button3_triple_press_cover:
      name: "Button 3 – Triple Press – Cover/Curtain (optional)"
      selector:
        entity:
          domain: cover
      default: ""

    button3_triple_press_cover_action:
      name: "Button 3 – Triple Press – Cover Action"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Open"
              value: "open"
            - label: "Close"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"

    button3_hold_light:
      name: "Button 3 – Hold/Release Light (optional)"
      selector:
        entity:
          domain: light
      default: ""

    button3_hold_direction:
      name: "Button 3 – Dimming Direction When Holding"
      selector:
        select:
          options:
            - label: "Brighten (increase)"
              value: "brighter"
            - label: "Darken (decrease)"
              value: "darker"
      default: "brighter"

    button3_hold_brightness_step:
      name: "Button 3 – Brightness Per Step (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

trigger:
  - platform: state
    entity_id:
      - !input button1_event_entity
    id: button1

  - platform: state
    entity_id:
      - !input button2_event_entity
    id: button2

  - platform: state
    entity_id:
      - !input button3_event_entity
    id: button3

condition: []

action:
  - variables:
      button1_event: !input button1_event_entity
      button2_event: !input button2_event_entity
      button3_event: !input button3_event_entity

      button1_single_press_light_value: !input button1_single_press_light
      button1_single_press_action_value: !input button1_single_press_action
      button1_double_press_light_value: !input button1_double_press_light
      button1_double_press_type_value: !input button1_double_press_type
      button1_double_press_light_action_value: !input button1_double_press_light_action
      button1_double_press_scene_value: !input button1_double_press_scene
      button1_triple_press_light_value: !input button1_triple_press_light
      button1_triple_press_type_value: !input button1_triple_press_type
      button1_triple_press_light_action_value: !input button1_triple_press_light_action
      button1_triple_press_scene_value: !input button1_triple_press_scene
      button1_hold_light_value: !input button1_hold_light
      button1_hold_direction_value: !input button1_hold_direction
      button1_hold_brightness_step_value: !input button1_hold_brightness_step

      button2_single_press_light_value: !input button2_single_press_light
      button2_single_press_action_value: !input button2_single_press_action
      button2_double_press_light_value: !input button2_double_press_light
      button2_double_press_type_value: !input button2_double_press_type
      button2_double_press_light_action_value: !input button2_double_press_light_action
      button2_double_press_scene_value: !input button2_double_press_scene
      button2_triple_press_light_value: !input button2_triple_press_light
      button2_triple_press_type_value: !input button2_triple_press_type
      button2_triple_press_light_action_value: !input button2_triple_press_light_action
      button2_triple_press_scene_value: !input button2_triple_press_scene
      button2_hold_light_value: !input button2_hold_light
      button2_hold_direction_value: !input button2_hold_direction
      button2_hold_brightness_step_value: !input button2_hold_brightness_step

      button3_single_press_type_var: !input button3_single_press_type
      button3_single_press_light_value: !input button3_single_press_light
      button3_single_press_action_value: !input button3_single_press_action
      button3_single_press_scene_var: !input button3_single_press_scene
      button3_single_press_cover_var: !input button3_single_press_cover
      button3_single_press_cover_action_var: !input button3_single_press_cover_action

      button3_double_press_type_var: !input button3_double_press_type
      button3_double_press_light_value: !input button3_double_press_light
      button3_double_press_light_action_value: !input button3_double_press_light_action
      button3_double_press_scene_var: !input button3_double_press_scene
      button3_double_press_cover_var: !input button3_double_press_cover
      button3_double_press_cover_action_var: !input button3_double_press_cover_action

      button3_triple_press_type_var: !input button3_triple_press_type
      button3_triple_press_light_value: !input button3_triple_press_light
      button3_triple_press_light_action_value: !input button3_triple_press_light_action
      button3_triple_press_scene_var: !input button3_triple_press_scene
      button3_triple_press_cover_var: !input button3_triple_press_cover
      button3_triple_press_cover_action_var: !input button3_triple_press_cover_action

      button3_hold_light_value: !input button3_hold_light
      button3_hold_direction_value: !input button3_hold_direction
      button3_hold_brightness_step_value: !input button3_hold_brightness_step

      event_type: "{{ state_attr(trigger.entity_id, 'event_type') }}"
      trigger_entity: "{{ trigger.entity_id }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - SINGLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_1' and button1_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - DOUBLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_2' and button1_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_double_press_type_value == 'scene' and button1_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - TRIPLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_3' and button1_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_triple_press_type_value == 'scene' and button1_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - HOLD/RELEASE
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and (event_type == 'initial_press' or event_type == 'repeat') and button1_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - SINGLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_1' and button2_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - DOUBLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_2' and button2_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_double_press_type_value == 'scene' and button2_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - TRIPLE PRESS
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_3' and button2_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_triple_press_type_value == 'scene' and button2_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - HOLD/RELEASE
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and (event_type == 'initial_press' or event_type == 'repeat') and button2_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - SINGLE PRESS (CORRECTED)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_1' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_single_press_type_var == 'cover' and button3_single_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_single_press_type_var == 'scene' and button3_single_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_single_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - DOUBLE PRESS (CORRECTED)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_2' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_double_press_type_var == 'cover' and button3_double_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_double_press_type_var == 'scene' and button3_double_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_double_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - TRIPLE PRESS (CORRECTED)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_3' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_triple_press_type_var == 'cover' and button3_triple_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_triple_press_type_var == 'scene' and button3_triple_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_triple_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - HOLD/RELEASE
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and (event_type == 'initial_press' or event_type == 'repeat') and button3_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value * -1 }}"

mode: parallel
max: 10
